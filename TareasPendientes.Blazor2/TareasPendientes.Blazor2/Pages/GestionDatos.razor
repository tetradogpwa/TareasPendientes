@page "/GestionDatos"
@using Blazor.FileReader
@using System.IO;
@inject IFileReaderService fileReaderService
@inject IJSRuntime JS
<h3>Gestión Datos</h3>
<text>Cargar </text><input type="file" @ref="inpCargarBD" @onchange="CargarBD" accept=".json" /><br/><br/>
<button class="btn btn-success" @onclick="@(()=>JS.DownloadFileAsync("datos.json",Datos.ToJson(),"application/json"))">Descargar</button>
@code {
    [CascadingParameter] Data Datos { get; set; }
    ElementReference inpCargarBD;
    async Task CargarBD()
    {
        const int BUFFER = 4 * 1024;

        foreach (IFileReference file in await fileReaderService.CreateReference(inpCargarBD).EnumerateFilesAsync())
        {
            try
            {
                Datos.Load(System.Text.ASCIIEncoding.ASCII.GetString(await file.Read(BUFFER)));
            }
            catch(Exception ex) {
                await JS.MostrarMensajeAsync($"Ha ocurrido un error al cargar el archivo....\n {ex.Message}");
            }

        }
    }
}
