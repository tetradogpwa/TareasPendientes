@page "/"

@inject NavigationManager Nav
@if (context == null)
{
    <Cargando />
}
else
{
    <div class="float-left  LaMitadDeEspacio" id="ParteListas">
        <select class="TodoElEspacio" @bind="@context.Main.IndexCategoria">
            @for (int i = 0; i < context.Categorias.Count; i++)
            {
                <option class="TodoElEspacio" value="@i">@context.Categorias[i].Nombre</option>
            }
        </select>
        <br />
        <div>
            <VisorListas Listas="@context.Main.Listas" OnClick="@MostrarLista" />
            <div>
                <input class="TodoElEspacio" type="text" @bind-value="context.Main.NameList" @onkeypress="@CreateListOnKeyPress" />

            </div>
        </div>
    </div>
    <div class="float-right LaMitadDeEspacio" id="ParteTareas">
        <input class="TextBox-NombreLista TodoElEspacio" type="text" @bind="@context.Main.ListaActual.Nombre" />
        <div>
            <label><input type="checkbox" @bind="context.Main.EditMode" />Editar</label>
            <button class="btn btn-light" id="Add-Tarea" @onclick="@AddTarea" value="+" disabled="@(!context.Main.HayLista)">+</button>
        </div>
        <VisorTareas Lista="@context.Main.ListaActual" EditMode="@context.Main.EditMode" />

    </div>
}


@code {

    [CascadingParameter] Context context { get; set; }
    void CreateListOnKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" && !String.IsNullOrEmpty(context.Main.NameList) && !String.IsNullOrWhiteSpace(context.Main.NameList))
            AddList();
    }

    void AddList()
    {
        context.Listas.Add(new Lista(context.Main.NameList.Trim()));
        context.Main.NameList = null;
    }
    void AddTarea()
    {
        if (context.Main.HayLista)
            context.Main.ListaActual.AddTarea();
    }
    void MostrarLista(Lista lista)
    {
        context.Main.ListaActual = lista;
        Nav.NavigateTo("/");
    }

}
